<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<menuitem id="menu_hr_root_payroll_ma" parent="menu_ressources_humaines_root" name="Gestion de la paie" />
		<menuitem id="menu_hr_payroll_teledeclaration_ma" parent="menu_ressources_humaines_root" name="Télédéclarations" />

		<record id="hr_payroll_ma_form" model="ir.ui.view">
			<field name="name">hr.payroll_ma.form</field>
			<field name="model">hr.payroll_ma</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Bulletin de paie">
					<header>
						<button name="generate_employees" string="Ajouter Employés" type="object"  attrs="{'invisible':[('state','!=','draft')]}"/>
						<button name="compute_all_lines" string="Générer bulletins" type="object"  attrs="{'invisible':[('state','!=','draft')]}"/>
						<button name="draft_cb" string="Brouillon" type="object" states="confirmed,cancelled" icon="fa-eraser" />
						<button name="confirm_cb" string="Confirmer" type="object" states="draft" icon="fa-check-circle" />
						<button name="cancel_cb" string="Annuler" type="object" states="draft" />
						<field name="state" widget="statusbar" statusbar_visible="draft,confirmed" statusbar_colors='{"confirmed":"blue"}'/>
					</header>
					<group>
						<field name="name"/>
					</group>
					<group name="detail">
						<group>
							<field name="number" />
							<field name="journal_id" options="{'no_create': True, 'no_open':True}" />
							<field name="company_id" readonly="1" groups="base.group_multi_company"/>

						</group>
						<group>
							<field name="date_salary" required="True" />
							<field name="period_id"/>
							<field name="date_start" />
							<field name="date_end" />
						</group>

					</group>

					<notebook>
						<page string="Bulletins">
							<field name="bulletin_line_ids"
								   context="{'date_start':date_start,'period_id':period_id,'date_end':date_end }"
								   nolabel="1" widget="one2many_list" >
							<form string="Bulletins">
								<group>
									<field name="id_payroll_ma" invisible="1" />
									<field name="name" />
								</group>
							<group col="3">
								<group string="Employé">
									<field name="employee_id" domain="[('active', '=',True)]" options="{'no_create': True,'no_open':True}"/>
									<field name="employee_contract_id" options="{'no_create': True,'no_open':True}"/>
								</group>
								<group string="Base">
									<field name="working_days" />
									<field name="salaire_base" />
									<field name="salary_type" invisible="1" />
								</group>
								<group string="Période">
									<field name="date_start" />
									<field name="date_end" />
									<field name="period_id" invisible="0" options="{'no_create': True, 'no_open':True}"/>
								</group>

							</group>
							<notebook>
								<page string="Lignes du bulletin">
									<field name="salary_line_ids" nolabel="1" widget="one2many_list" />
									<group col="3">
										<group string="Brut">
											<field name="salaire_brute" />
											<field name="salaire_brute_imposable" />
										</group>
										<group string="Net">
											<field name="salaire_net_imposable" />
											<field name="salaire_net" />
											<field name="salaire_net_a_payer" />
										</group>
										<group string="Cotisations">
											<field name="cotisations_employee" />
											<field name="cotisations_employer" />
										</group>
									</group>
									<!--<separator string="Cumuls"/>-->
									<group string="Cumuls" col="3">
										<group>
											<field name="cumul_work_days" />
											<field name="cumul_sb" />
											<field name="cumul_sbi" />
											<field name="cumul_sni" />
											<field name="cumul_base" />
										</group>
										<group>
											<field name="cumul_avn" />
											<field name="cumul_avantages" />
											<field name="cumul_igr" />
											<field name="cumul_exo" />
										</group>
										<group>
											<field name="cumul_ee_cotis" />
											<field name="cumul_er_cotis" />
											<field name="cumul_fp" />
											<field name="cumul_indemnites_fp" />

										</group>
									</group>
									<group >
										<field name="salaire_net_a_payer_text" />
									</group>
								</page>
								<page string="Info Salaire">
									<group>
										<group string="Horaires">
											<field name="hour_base"/>
											<field name="normal_hours"/>
										</group>
										<group string="Autres informations">
											<field name="igr" />
											<field name="deduction" />
										</group>
									</group>
								</page>
							</notebook>
						</form>
						<tree  string="Bulletins">
							<field name="name" select="1"/>
							<field name="employee_id" options="{'no_create': True,'no_open':True}"/>
							<field name="working_days" sum="total_0"/>
							<field name="salaire_brute" sum="total_1"/>
							<field name="salaire_brute_imposable" sum="total_2"/>
							<field name="cotisations_employee" sum="total_3"/>
							<field name="cotisations_employer" sum="total_4"/>
							<field name="salaire_net" sum="total_5"/>
							<field name="salaire_net_a_payer" sum="total_6"/>
						</tree>
					</field>
					</page>
						<page string="Comptabilité">
							<group>
								<field name="move_id" />
							</group>
						</page>
					</notebook>
				</form>
			</field>
		</record>

<!--		<record id="hr_payroll_ma_tree" model="ir.ui.view">-->
<!--			<field name="name">hr.payroll_ma.tree</field>-->
<!--			<field name="model">hr.payroll_ma</field>-->
<!--			<field name="type">tree</field>-->
<!--			<field name="arch" type="xml">-->
<!--				<tree colors="blue:state=='draft'" string="Saisie mensuelle">-->
<!--					<field name="name" select='1' />-->
<!--					<field name="number" select='1' />-->
<!--					<field name="period_id" select='1' />-->
<!--					<field name="date_salary"/>-->
<!--					<field name="state" select='1' />-->
<!--				</tree>-->
<!--			</field>-->
<!--		</record>-->

		<record model="ir.actions.act_window" id="hr_payroll_ma_all_act">
			<field name="name">Saisie Mensuelle</field>
			<field name="res_model">hr.payroll_ma</field>
			<field name="view_mode">tree,form</field>
		</record>

		<menuitem action="hr_payroll_ma_all_act" id="menu_hr_payroll_ma"
			parent="menu_hr_root_payroll_ma" />

		<record id="view_payslip_filter" model="ir.ui.view">
            <field name="name">Bulletin</field>
            <field name="model">hr.payroll.ma.bulletin</field>
            <field name="arch" type="xml">
                <search string="Bulletins de paie">
                    <field name="employee_id"/>
                    <field name="period_id"/>
                    <group expand="0" string="Group By">
                        <filter string="Employé" name="employe" domain="[]" context="{'group_by':'employee_id'}"/>
                        <filter string="Mois" name="month" domain="[]" context="{'group_by':'period_id'}"/>
                    </group>
                </search>
             </field>
         </record>

		<record id="salary_tree" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.tree</field>
			<field name="model">hr.payroll.ma.bulletin</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Bulletin" create="false" edit="false">
					<field name="name" />
					<field name="employee_id"  />
					<field name="period_id"  />
					<field name="working_days" sum="Total"/>
					<field name="normal_hours" />
					<field name="salaire_brute" sum="Total"/>
					<field name="salaire_brute_imposable" sum="Total"/>
					<field name="cotisations_employee" sum="Total"/>
					<field name="cotisations_employer" sum="Total"/>
					<field name="salaire_net_a_payer" sum="Total"/>
				</tree>
			</field>
		</record>

		<record id="salary_form" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.form</field>
			<field name="model">hr.payroll.ma.bulletin</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Bulletins" create="false" edit="false">
					<group>
						<field name="name" />
					</group>
					<group name="detail">
						<group >
							<field name="employee_id" domain="[('active', '=',True)]" options="{'no_create': True,'no_open':True}"/>
							<field name="employee_contract_id" domain="[('employee_id', '=',employee_id)]" options="{'no_create': True}"/>
						</group>
						<group>
							<field name="working_days" />
							<field name="salary_type" invisible="1" />
							<field name="salaire_base" />
							<field name="company_id" groups="base.group_multi_company" force_save="1"/>
							<button name="compute_all_lines" string="Calculer bulletin"
							type="object" icon="fa-exchange" />
						</group>

					</group>
					<notebook >
						<page string="Lignes du bulletin">
							<field colspan="4" name="salary_line_ids" nolabel="1" widget="one2many_list" />
						<group colspan="4" col="3">
							<group string="Brute">
								<field name="salaire_brute" />
								<field name="salaire_brute_imposable" />
							</group>
							<group string="Net">
								<field name="salaire_net" />
								<field name="salaire_net_imposable" />
								<field name="salaire_net_a_payer" />
							</group>
							<group string="Cotisations">
								<field name="cotisations_employee" />
								<field name="cotisations_employer" />
							</group>
						</group>
						<separator string="Cumuls"/>
						<group col="3">

							<group>
								<field name="cumul_work_days" />
								<field name="cumul_sb" />
								<field name="cumul_sbi" />
								<field name="cumul_sni" />
							</group>
							<group>
								<field name="cumul_avn" />
								<field name="cumul_igr" />
								<field name="cumul_ee_cotis" />
								<field name="cumul_er_cotis" />
							</group>
							<group>
								<field name="cumul_fp" />
								<field name="cumul_indemnites_fp" />

								<field name="cumul_exo" />
							</group>
						</group>
						<group colspan="4">
							<field name="salaire_net_a_payer_text" />
						</group>						
						</page>
						<page string="Info Salaire">
							<group>
								<group string="Horaires">
									<field name="hour_base" />
									<field name="normal_hours" />
								</group>
								<group string="Autres informations">
									<field name="igr" />
									<field name="deduction" />
									<field name="period_id" options="{'no_create': True, 'no_open':True}"/>
								</group>
							</group>
						</page>
					</notebook>
				</form>
			</field>
		</record>

		<record id="action_salary_tree" model="ir.actions.act_window">
			<field name="name">Bulletins de paie</field>
			<field name="res_model">hr.payroll.ma.bulletin</field>
			<field name="view_mode">tree,form</field>
		</record>

		<menuitem action="action_salary_tree" id="menu_bulletin"
			parent="menu_hr_root_payroll_ma" />
			
	<!-- Lignes Bulletins de paie-->
		<record id="view_salary_line_tree" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.line.tree</field>
			<field name="model">hr.payroll_ma.bulletin.line</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Ligne de salaire">
					<field name="name" />
					<field name="base" />
					<field name="rate_employee" />
					<field name="subtotal_employee" />
					<field name="rate_employer" />
					<field name="subtotal_employer" />
					<field name="debit_account_id" />
					<field name="credit_account_id" />
				</tree>
			</field>
		</record>


		<record id="view_salary_line_pivot" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.line.pivot</field>
			<field name="model">hr.payroll_ma.bulletin.line</field>
			<field name="type">pivot</field>
			<field name="arch" type="xml">
				<pivot>
					<field name="name"/>
					<field name="subtotal_employee"/>
					<field name="subtotal_employer"/>
				</pivot>
			</field>
		</record>
		<record id="view_salary_line_graph" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.line.graph</field>
			<field name="model">hr.payroll_ma.bulletin.line</field>
			<field name="type">graph</field>
			<field name="arch" type="xml">
				<graph>
					<field name="name"/>
					<field name="subtotal_employee" type="measure"/>
					<field name="subtotal_employer" type="measure"/>
				</graph>
			</field>
		</record>

		<record id="view_salary_line_form" model="ir.ui.view">
			<field name="name">hr.payroll_ma.bulletin.line.form</field>
			<field name="model">hr.payroll_ma.bulletin.line</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Ligne de salaire">
					<group>
						<group string="Détail">
							<field name="name" />
							<field name="type" />
							<field name="deductible" />
							<field name="rubrique_id" readonly="1"/>
							<field name="cotisation_id" readonly="1"/>
						</group>
						<group string="Montants">
							<field name="base" />
							<field name="rate_employee" />
							<field name="subtotal_employee" />
							<field name="rate_employer" />
							<field name="subtotal_employer" />
						</group>
						<group string="Comptes comptables">
							<field name="credit_account_id" string="Compte de crédit" options="{'no_create': True, 'no_open':True}"/>
							<field name="debit_account_id" string="Compte de débit" options="{'no_create': True, 'no_open':True}"/>
						</group>
						<group >
							<field name="employee_id" invisible="1"/>
							<field name="matricule" invisible="1"/>
							<field name="department_id" invisible="1"/>
							<field name="job_id" invisible="1"/>
							<field name="date_salary" invisible="1"/>
							<field name="period_id" invisible="1"/>
						</group>
					</group>
					<group string="Notes">
						<field name="note" nolabel="1" />
					</group>
				</form>
			</field>
		</record>

		<!--
		 Rubriques
		-->

		<record model="ir.ui.view" id="rubrique_form">
			<field name="name">hr.payroll_ma.rubrique.form</field>
			<field name="model">hr.payroll_ma.rubrique</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Rubriques">
					<group col="4">
						<field name="name" />
						<field name="code" />
						<field name="categorie" />
						<field name="is_hourly" attrs="{'invisible':[('categorie','==','deduction')]}"/>
						<field name="afficher" invisible="1" />
						<field name="pourcentage" attrs="{'invisible':[('is_hourly','=',False)]}"/>
						<field name="company_id" groups="base.group_multi_company" />
					</group>
					<group  attrs="{'invisible':[('categorie','==','deduction')]}">
						<group string="Type">
							<field name="type" />
							<field name="type_traitement" />
							<field name="imposable" />
							<field name="plafond" />
							<field name="formule" invisible="1" />
						</group>
						<group string="Soumise A" >
							<field name="ir" />
							<field name="anciennete" />
							<field name="absence" />
							<field name="conge" invisible="1"/>
						</group>
					</group>
					<group col="4">
						<field name="credit_account_id" options="{'no_create': True, 'no_open':True}"/>
						<field name="debit_account_id"  options="{'no_create': True, 'no_open':True}"/>
						<field name="sequence"/>
						<field name="note" />
					</group>
				</form>
			</field>
		</record>

		<record model="ir.ui.view" id="rubrique_tree">
			<field name="name">hr.payroll_ma.rubrique.tree</field>
			<field name="model">hr.payroll_ma.rubrique</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Rubriques">
					<field name="code" />
					<field name="name" />
					<field name="categorie" />
					<field name="company_id" groups="base.group_multi_company"/>
					<field name="afficher" />
				</tree>
			</field>
		</record>

		<record model="ir.actions.act_window" id="rubrique_all_act">
			<field name="name">Rubriques</field>
			<field name="res_model">hr.payroll_ma.rubrique</field>
			<field name="view_mode">tree,form</field>
		</record>
		<record model="ir.actions.act_window" id="bulletin_line_action">
			<field name="name">Analyse de la paie</field>
			<field name="res_model">hr.payroll_ma.bulletin.line</field>
			<field name="view_mode">pivot,graph,tree</field>
		</record>
		<menuitem id="menu_hr_payroll_ma_reports" parent="menu_ressources_humaines_root" name="Rapport" />
		<menuitem id="menu_hr_payroll_ma_bulletin_line_report" parent="menu_hr_payroll_ma_reports" action="bulletin_line_action" />





<!--		<menuitem action="rubrique_all_act" id="rubrique_all_mi" parent="payroll_ma_configure" />-->


		<!-- ##################Lignes de rubriques ########################-->
		<record model="ir.ui.view" id="ligne_rubrique_form">
			<field name="name">hr.payroll_ma.ligne_rubrique.form</field>
			<field name="model">hr.payroll_ma.ligne_rubrique</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Lignes rubriques">
					<group>
						<group>
							<field name="rubrique_id" required="True" options="{'no_create': True, 'no_open':True}"/>
							<field name="montant" required="True" />
							<field name="taux" />
							<field name="permanent" />
						</group>
						<group  attrs="{'invisible':[('permanent','==',True)]}">
							<field name="period_id" options="{'no_create': True, 'no_open':True}" />
							<field name="date_start" />
							<field name="date_stop" />
						</group>
					</group>
					<separator string="Commentaire" colspan="4" />
					<field name="note" />
				</form>
			</field>
		</record>

		<record model="ir.ui.view" id="ligne_rubrique_tree">
			<field name="name">hr.payroll_ma.ligne_rubrique.tree</field>
			<field name="model">hr.payroll_ma.ligne_rubrique</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="rubriques">
					<field name="rubrique_id" />
					<field name="montant" />
					<field name="permanent" />
					<field name="date_start" />
					<field name="date_stop" />
					<field name="note" />
				</tree>
			</field>
		</record>

<!--		<act_window name="Mes bulletins de paie" domain="[('employee_id', '=', active_id)]"-->
<!--			res_model="hr.payroll.ma.bulletin" src_model="hr.employee"-->
<!--			id="act_hr_employee_bulletin" />-->
<!--			-->
<!--		<act_window name="bulletins de paie" domain="[('id_payroll_ma', '=', active_id)]"-->
<!--			src_model="hr.payroll_ma" res_model="hr.payroll.ma.bulletin"-->
<!--			id="act_hr_payroo_ma_bulletin" />-->

<!--		<act_window name="Ecritures Comptables" res_model="account.move"-->
<!--			src_model="hr.payroll_ma" id="act_hr_payroll_ma_ecriture" />-->
	</data>
</odoo>